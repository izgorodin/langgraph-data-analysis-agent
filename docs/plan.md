# План выполнения работы

## Цели
- Реализовать CLI‑агента на LangGraph для анализа датасета `bigquery-public-data.thelook_ecommerce` в BigQuery.
- Обеспечить безопасность SQL (SELECT‑only, whitelist таблиц, лимиты, валидация).
- Сформировать отчёт с числовыми инсайтами и следующими шагами.
- Подготовить чистую документацию (ADR, README, диаграмма) и backlog задач.

## Объём (scope)
- CLI чат: ввод вопроса, пошаговый прогон узлов графа, финальный отчёт.
- Интеграции: BigQuery, Gemini (google-generativeai). Bedrock — опционально как фолбэк.
- Узлы графа: plan → synthesize_sql → validate_sql → execute_sql → analyze_df → report.
- Защита: sqlglot‑валидация, ограничение таблиц и лимиты BigQuery.

## Критерии успеха
- Команда запуска устанавливает зависимости и получает отчёт по примеру запросов.
- Сгенерированный SQL валиден, не нарушает политики, укладывается в лимиты.
- Отчёт содержит конкретные цифры из результата и 1–2 разумных next steps.
- Репозиторий содержит ADR, диаграмму, понятный README, и задачи.

## Тайм‑бокс (4–8 часов)
- 0–1.5 ч: каркас, конфиг, BigQuery клиент, схемы.
- 1.5–3 ч: узлы графа, валидация SQL.
- 3–4 ч: анализ DF и отчёт, CLI, прогоны.
- 4–5 ч: документация (README, диаграмма, ADR), .env.example.
- 5–6 ч: обработка ошибок, полировка, самопроверка.
- 6–8 ч: улучшения по времени, рефакторинг промптов.

## Риски и меры
- Квоты BigQuery — ограничить MAX_BYTES_BILLED, сужать интервал времени.
- Нестабильность LLM — добавлять детерминированные заготовки и ограничения в промптах.
- Схемы — кешировать и явно включать в контекст планирования.
