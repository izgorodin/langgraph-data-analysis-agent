# ADR 003 — Безопасность и валидация SQL

Дата: 2025-08-18

## Статус
Принято

## Контекст
LLM может сгенерировать некорректный или опасный SQL. Требуются ограничения и валидация перед исполнением в BigQuery.

## Решение
- Парсинг через `sqlglot` (диалект BigQuery)
- Разрешаем только `SELECT`
- Белый список таблиц: `orders, order_items, products, users`
- Принудительный `LIMIT 1000` для неагрегирующих запросов
- `maximum_bytes_billed` и `use_query_cache` в конфигурации BigQuery

## Последствия
- Снижение риска дорогостоящих/опасных запросов
- Повышение предсказуемости работы агента
