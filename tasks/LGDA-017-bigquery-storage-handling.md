# LGDA-017: BigQuery Storage Client Handling and Warning Management

**Priority**: MEDIUM | **Type**: Performance/UX | **Parallel**: Can run with LGDA-012

## Архитектурный контекст
На рантайме появляется предупреждение: BigQuery Storage module не установлен. Нужно определить стратегию: опциональная зависимость для ускорения `to_dataframe` или явное использование REST-пути с чистыми логами.

## Цель задачи
Сделать поведение предсказуемым: если модуль установлен — использовать его; если нет — не шуметь в логах и работать через REST, с понятной конфигурацией.

## Детальный анализ
- Текущее состояние: предупреждение без действия может пугать пользователей и засорять логи.
- Возможность ускорения: `google-cloud-bigquery-storage` даёт ускорение чтения.

## Решение (Solution Architecture)
1. Опциональная зависимость
   - Добавить в `requirements-optional.txt` пакет `google-cloud-bigquery-storage` и флаг `LGDA_USE_BQ_STORAGE`.
2. Кодовая ветвление
   - В `src/bq.py`: try/except импорт; если доступен и включён — использовать BQ Storage; иначе REST.
3. Логи
   - Единоразовый info-лог при старте с подсказкой «как ускорить», без повторяющихся предупреждений.
4. Документация
   - Обновить README/SETUP_REQUIREMENTS с инструкцией по установке optional deps.

## Критерии приемки
- Нет навязчивых предупреждений при отсутствии модуля; поведение детерминированно.
- При включении флага и наличии пакета — используется Storage API (покрыто unit-testом stub).

## Возможные сложности
- Совместимость версий `google-cloud-bigquery` и `-storage`.
- Отладка производительности в разных окружениях.

## Integration Points
- LGDA-012 Performance — оценка выигрыша от Storage API.
- LGDA-011 Observability — лог-сообщение один раз при старте, метрика скорости чтения.

## ADR References
- ADR-006 Data Access Strategy — политика доступа к данным и оптимизации.

## Безопасность
- Соблюдать лимиты доступа к таблицам (whitelist) вне зависимости от канала чтения.
- Исключить утечки через логи (без SQL/секретов/PII).

## Зависимости
- LGDA-012 (performance) опционально

## Оценка трудозатрат
0.5 дня | Изменения: 2 файла | Тесты: 2–3
